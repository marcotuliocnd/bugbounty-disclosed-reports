# CVE-2023-27538: SSH connection too eager reuse still

## Report Details
- **Report ID**: 1898475
- **URL**: https://hackerone.com/reports/1898475
- **State**: Closed
- **Severity**: low
- **Submitted**: 2023-03-09T18:09:38.189Z
- **Disclosed**: 2023-03-22T18:59:35.434Z

## Reporter
- **Username**: nyymi
- **Name**: N/A

## Team
- **Name**: N/A
- **Handle**: curl

## Vulnerability Information
## Summary:
There's a check if SSH keys match between new and existing connection when considering reuse. This check is broken due to wrong comparison:
`#define PROTO_FAMILY_SSH  (CURLPROTO_SCP|CURLPROTO_SFTP)`
...
`else if(get_protocol_family(needle->handler) == PROTO_FAMILY_SSH) {`
This never matches as handler family is either `CURLPROTO_SCP` or `CURLPROTO_SFTP`.

## Remediation

* Make the code:
`else if(get_protocol_family(needle->handler) & PROTO_FAMILY_SSH) {`

## Steps To Reproduce:

  1. Make two connections to the same host with different ssh keys

## Impact

Connection reuse when different ssh keys are used.

## Attachments
No attachments
